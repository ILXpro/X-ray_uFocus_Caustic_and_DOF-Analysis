### X-ray Micro-focus Caustic & Depth of Focus Analysis

This repository contains a set of Python scripts for the automated analysis of X-ray beam focusing experiments. Developed for the P14 beamline at DESY, the tool processes image series to measure key beam parameters such as position and size (FWHM), and subsequently performs a comprehensive analysis of the beam's caustic and Depth of Focus (DOF). This project serves as a practical example of applying data analysis and visualization techniques to solve problems in a high-tech scientific environment.

**Key Features:**

  * **Two-Stage Processing**: The project is structured into two distinct stages: raw image processing and a final analysis/visualization stage.
  * **Beam Parameter Extraction**: Automatically detects the beam spot, extracts its centroid position, and fits line profiles with a Gaussian model to determine the Full Width at Half Maximum (FWHM).
  * **Caustic & DOF Analysis**: Analyzes the evolution of the beam size (FWHM) as a function of the longitudinal distance ($L\_2$) to determine the beam's caustic shape and its minimum focus size.
  * **Automated Visualization**: Generates a variety of plots, including caustic heatmaps, FWHM vs. distance graphs, and detailed single-image analysis reports.
  * **Data Handling**: Stores all extracted data and results in NumPy and CSV files for easy access and further post-processing.

### Project Structure

The workflow is divided into three main scripts:

  * **`DOF_main_and_config.py`**: This is the main entry point and configuration file. Here you can define all essential parameters such as `pixel_size`, `ROI` (Region of Interest), `lp_lenth` (line profile length), and the path to your raw image data. It orchestrates the execution of either Stage 1 or Stage 2.
  * **`DOF_analysis_stage1_v3.py`**: **(Data Collection & Fitting)** This script is responsible for the initial processing of raw images. It reads all files from the specified directory, identifies the beam spot on each image, and performs a Gaussian fit on the horizontal and vertical intensity profiles. The extracted FWHM values, their uncertainties, and the raw profile data are saved for the next stage.
  * **`DOF_analysis_stage2_v3.py`**: **(Final Analysis & Visualization)** This script takes the saved data from Stage 1 to perform a higher-level analysis. It determines the minimum focus size, plots the beam caustic (a graphical representation of the beam envelope), and generates comprehensive graphs showing the relationship between FWHM and the longitudinal distance ($L\_2$).

### Demonstration

The following images illustrate the types of outputs generated by the analysis scripts.

**Single-Frame Analysis**: A detailed report for a single image, showing the detected beam spot, extracted intensity profiles with Gaussian fits, and a summary of calculated parameters.

**Evolutionary Analysis**: A summary plot showing the change in the beam spot's position and size (FWHM) over a series of images at different $L\_2$ distances. This visualization is crucial for understanding the beam's long-term stability and caustic.

### How to Use

1.  **Configure Parameters**: Open `DOF_main_and_config.py` and set the paths to your image data and all necessary experimental parameters (pixel size, ROI, etc.).
2.  **Run Stage 1**: Uncomment the line `exec(open("DOF_analysis_stage1_v3.py").read())` and comment out the line for Stage 2. Execute the `DOF_main_and_config.py` script to process your raw images.
3.  **Run Stage 2**: Once Stage 1 is complete, comment out its execution line and uncomment the line for Stage 2. Run the script again to generate the final plots and statistical summaries.

### Technologies

  * **Python 3**
  * **NumPy**: For numerical operations.
  * **Matplotlib**: For all data visualization.
  * **Pillow (PIL)**: For image loading and manipulation.
  * **SciPy**: For signal and image processing.
  * **LMFit**: For nonlinear least-squares fitting (Gaussian model).
  * **scikit-image**: For image processing tasks such as peak detection.
  * **matplotlib-scalebar**: For adding accurate scale bars to plots.